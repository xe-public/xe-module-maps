/* Copyright (C) Kim, MinSoo <misol.kr@gmail.com> */
function map_point(a){center=result_array[a].geometry.location,map.setCenter(center)}function view_list(){var a="";if(0==result_array.length)return void alert(no_result);for(var r=0;r<result_array.length;r++){0==r&&(a+='<ul id="view_list">'),1==result_array.length&&map_point("0");var e=result_array[r].formatted_address.split(" "),o=result_array[r].formatted_address.substring(result_array[r].formatted_address.lastIndexOf(e[e.length-3]));a+='<li class="result_lists"><a href="javascript:map_point(\''+r+"');\">"+o+"</a></li>"}a+="</ul>",jQuery("#result_list_layer").html(a)}function showLocation(a){if(result_from="",a){var r=new Array;r.query=a;var e=new Array("error","message","results");exec_xml("maps","getMapsAdminLocation",r,function(r,e){complete_search(r,e,a)},e)}}function complete_search(a){var r=a.results;r=r?r.item:new Array,address_adder(r)}function address_adder(a){result_array=new Array,"undefined"==typeof a.length&&(a=new Array(a));for(var r=0;r<a.length;r++)(a[r].formatted_address||null!=a[r].formatted_address)&&(result_array[r]={from:a[r].result_from,formatted_address:a[r].formatted_address,geometry:{location:new google.maps.LatLng(a[r].geometry.lat,a[r].geometry.lng)}});view_list()}function getMaps(){var a={zoom:map_zoom,center:new google.maps.LatLng(defaultlat,defaultlng),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT},panControl:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_CENTER},scaleControl:!1,streetViewControl:!1,disableDoubleClickZoom:!0};if(map=new google.maps.Map(document.getElementById("map_canvas"),a),saved_maps_srl>0){var r=saved_map_center.split(",");e=new google.maps.LatLng(r[0],r[1]);{saved_map_markers.split(";")}map_marker_positions=saved_map_markers.trim(),marker=addMarker(0),map_zoom=parseInt(saved_map_zoom,10),map_zoom||(map_zoom=13)}else e=new google.maps.LatLng(defaultlat,defaultlng);map.setCenter(e);var e=map.getCenter();map.setZoom(map_zoom),google.maps.event.addListener(map,"click",function(a){latlng=a.latLng,addMarker(latlng)})}function addMarker(a){var r;if("undefined"!=typeof map_markers)for(var e=0;e<map_markers.length;e++)map_markers[e].setMap(null);map_markers=new Array,0!=a&&(map_marker_positions=positionstrRemover(a,map_marker_positions),map_marker_positions+=a.lat()+","+a.lng()+";"),positions=makeLocationArray(map_marker_positions);for(var e=0;e<positions.length;e++)map_markers[e]=new google.maps.Marker({position:positions[e]}),map_markers[e].setMap(map),map_markers[e].setDraggable(!0),map_markers[e].soo_position=positions[e],r=map_markers[e],google.maps.event.addListener(map_markers[e],"dragstart",function(){var a=this.soo_position;map_marker_positions=positionstrRemover(a,map_marker_positions)}),google.maps.event.addListener(map_markers[e],"dragend",function(){var a=this.getPosition();map_marker_positions=positionstrRemover(a,map_marker_positions),map_marker_positions+=a.lat()+","+a.lng()+";",addMarker(0)}),google.maps.event.addListener(map_markers[e],"click",function(){var a=this.soo_position;removeMarker(a)});return r}function removeMarker(a){for(var r=0;r<map_markers.length;r++)map_markers[r].setMap(null);map_markers=new Array,map_marker_positions=positionstrRemover(a,map_marker_positions),positions=makeLocationArray(map_marker_positions);for(var r=0;r<positions.length;r++)map_markers[r]=new google.maps.Marker({position:positions[r]}),map_markers[r].setMap(map),map_markers[r].setDraggable(!0),map_markers[r].soo_position=positions[r],new_marker_obj=map_markers[r],google.maps.event.addListener(map_markers[r],"dragstart",function(){var a=this.soo_position;map_marker_positions=positionstrRemover(a,map_marker_positions)}),google.maps.event.addListener(map_markers[r],"dragend",function(){var a=this.getPosition();map_marker_positions=positionstrRemover(a,map_marker_positions),map_marker_positions+=a.lat()+","+a.lng()+";",addMarker(0)}),google.maps.event.addListener(map_markers[r],"click",function(){var a=this.soo_position;removeMarker(a)})}function positionstrRemover(a,r){for(var e=r.split(";"),o=0;o<e.length;o++)if(e[o].trim()){var t=e[o].split(","),s=new google.maps.LatLng(t[0],t[1]);s.equals(a)&&(r=r.replace(e[o]+";",""))}return r}function makeLocationArray(a){for(var r=new Array,e=a.split(";"),o=0;o<e.length;o++)if(e[o].trim()){var t=e[o].split(",");r[o]=new google.maps.LatLng(t[0],t[1])}return r}function makeLocationStr(a){for(var r="",e=0;e<a.length;e++)r+=a[e].lat()+","+a[e].lng()+";";return r}function saveMap(){var a=jQuery("#maps_srl").val(),r=jQuery("#map_title").val(),e=jQuery("#map_description").val();map_zoom=map.getZoom(),map_lat=map.getCenter().lat(),map_lng=map.getCenter().lng(),a||(a="NEW");var o={maps_srl:a,map_center:map_lat+","+map_lng,map_markers:map_marker_positions,map_zoom:map_zoom,map_title:r,map_description:e},t=new Array("error","message","maps_srl");exec_xml("maps","procMapsAdminInsert",o,function(a){var r=a.maps_srl;r>0&&(jQuery("#maps_srl").val(r),alert(maps_saved))},t)}var map_zoom=13,map_lat="",map_lng="",map="",marker="",map_markers=new Array,map_marker_positions="",modi_marker_pos="",saved_location=new Array,result_array=new Array,result_from="";jQuery(document).ready(function(){getMaps()});